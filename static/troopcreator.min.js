/*! troopcreator 2016-03-14 */

"use strict";(function(a,b,c,d,e,f,g){a["GoogleAnalyticsObject"]=e;a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date;f=b.createElement(c),g=b.getElementsByTagName(c)[0];f.async=1;f.src=d;g.parentNode.insertBefore(f,g)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-72234013-1","auto");var troopCreator=angular.module("troopCreator",["ngRoute","navModule","hc.commonmark","ngDragDrop"]);troopCreator.config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/dashboard/view/dashboard.html",controller:"dashboardCtrl"}).when("/build/:army",{templateUrl:"app/build/view/build.html",controller:"buildCtrl",reloadOnSearch:false}).when("/imprint",{templateUrl:"app/content/imprint.html"}).otherwise({redirectTo:"/"})}]);troopCreator.run(["$rootScope","$location","$window",function(a,b,c){a.$on("$locationChangeSuccess",function(){if(!c.ga||/127\.0\.0\.1/i.test(b.host())){return}c.ga("send","pageview",{page:b.path()})})}]);troopCreator.directive("tooltip",function(){return{restrict:"A",link:function(a,b,c){if(!$("#navi-icon").is(":visible")){$.fn.tooltip.Constructor.DEFAULTS.container="body";$(b).hover(function(){$(b).tooltip("show")},function(){$(b).tooltip("hide")})}}}});troopCreator.directive("selectOnClick",["$window",function(a){return{link:function(b,c){c.on("click",function(){var b=a.getSelection();var d=document.createRange();d.selectNodeContents(c[0]);b.removeAllRanges();b.addRange(d)})}}}]);troopCreator.directive("accordionToggle",function(){return{link:function(a,b){b.on("click",function(){var a=$(b).next(".accordion-container");if(a.is(":hidden")){a.slideDown()}else{a.slideToggle()}a.parent().siblings().find(".accordion-container").slideUp()})}}});troopCreator.filter("wildcardArmy",function(){return function(a,b){if(typeof b!=="undefined"){var c=b.replace(/[^A-za-zÄÖÜäöü?]/g,".*?");var d=new RegExp(".*?"+c+".*?","i");a=$.grep(a,function(a){return d.test(a.name)})}return a}});troopCreator.filter("range",function(){return function(a){var b=[];for(var c=1;c<=a;c++){b.push(c)}return b}});"use strict";troopCreator.controller("buildCtrl",["$scope","$http","$routeParams","$location","$window","$log",function(a,b,c,d,f,g){a.$log=g;b.get("./data/"+c.army+".json").success(function(e,g,h,i){a.data=[];$.each(e.groups,function(b,c){if(c.entries.length!==0){a.data.push(c)}});a.dropModel={};a.location=d;a.options={gameCaster:1,gamePoints:50,gameTier:"",gameObjective:"",modalLevel:0};a.vars={tiers:e.tiers,tierOptions:[],tier:{},tierLevel:0,selectedModels:[],casterPoints:0,points:0,costAlterations:[],faAlterations:[],freeModels:{id:[],count:0},faction:$("#"+c.army).data("faction"),factionId:"faction_"+c.army,system:$("#"+c.army).data("system"),objectives:["Arcane Wonder","Amory","Bunker","Effigy of Valor","Fuel Cache","Stockpile"],dragging:false};$.each(e.tiers,function(b,c){a.vars.tierOptions.push({key:b,label:c.name})});$.each(["minion","mercenary"],function(e,g){if(g!==c.army){b.get("./data/"+g+".json").success(function(b){$.each(b.groups,function(b,c){if(c.entries.length!==0){c.entries=$.grep(c.entries,function(b){if(b.works_for){if($.inArray(a.vars.factionId,b.works_for)!==-1){return true}}else if(b.restricted_to){if(/^ua/i.test(b.type)){return a.getModelById(b.restricted_to)}else{return true}}return false});c.add=g;a.data.push(c)}});if(g==="mercenary"||c.army==="mercenary"){if(!f.ga||/127\.0\.0\.1/i.test(d.host())){a.devAddId()}a.restoreSearch();a.$watchGroup(["options.gamePoints","options.gameCaster"],function(){a.updateSearch()})}}).error(function(a){alert("error reading "+g+".json")})}});var j=new Favico;var k=$("#"+c.army+" img")[0];j.image(k);document.title=a.vars.faction+" - Troop Creator";$("#top-menu li").removeClass("active");$("#"+c.army).closest("li").addClass("active");$(".btn").focus(function(){this.blur()})}).error(function(a,b,d,e){alert("error reading "+c.army+".json")});a.openList=function(){$("#left-col-build").toggleClass("active")};a.checkIsCaster=function(a){return/^warcaster$|^warlock$/i.test(a.type)};a.allowedModels=function(b){b=$.grep(b,function(b){if(a.options.gameTier){var c=a.vars.tiers[a.options.gameTier];if(c.levels[0].onlyModels.ids.indexOf(b.id)===-1&&c.casterId!==b.id){return false}}if(b.hasOwnProperty("restricted_to")){if(typeof b.restricted_to==="string"){if(a.getModelById(b.restricted_to)||b.restricted_to==="*"){return true}}else{var d=false;$.each(b.restricted_to,function(b,c){if(a.getModelById(c)){d=true;return false}});return d}return false}return true});return b};a.checkModelAvailable=function(b){var c=a.getModelCost(b,true),d=a.getModelFa(b);if(a.options.gameTier&&a.checkModelTier(b)){return true}if(typeof a.options.gameCaster==="undefined"||a.options.gameCaster.length===0||isNaN(a.options.gameCaster)){return true}if(typeof a.options.gamePoints==="undefined"||a.options.gamePoints.length===0||isNaN(a.options.gamePoints)){return true}if(/^warlock$|^warcaster$/i.test(b.type)&&a.countSelectedModel("^warlock$|^warcaster$").all>=a.options.gameCaster){return true}if(/warbeast|warjack/i.test(b.type)&&a.countSelectedModel("^warlock$|^warcaster$|lesserwarlock|journeyman|marshall").all===0){return true}else if(/warbeast|warjack/i.test(b.type)&&a.countSelectedModel("^warlock$|^warcaster$").all===0){var e=false;if(a.vars.selectedModels.length>0){$.each(a.vars.selectedModels,function(a,c){if(/marshall/i.test(c.type)&&c.group.length<2){e=true}else if(c.hasOwnProperty("restricted_to")){var d=c.restricted_to;if(typeof c.restricted_to==="string"){d=b.restricted_to.split(" ")}if(d.indexOf(b.id)!==-1){e=true}}else if(!/marshall/i.test(c.type)){e=true}return!e});if(e!==true){return true}}}if(/^warbeast$|^warjack$/i.test(b.type)&&parseInt(a.vars.casterPoints)>0){if(parseInt(a.options.gamePoints)-parseInt(a.vars.points)+parseInt(a.vars.casterPoints)<c){return true}}else if(!a.checkIsCaster(b)){if(parseInt(a.options.gamePoints)-parseInt(a.vars.points)<c){return true}}if(!d||d!=="U"){var f=a.countSelectedModel(b.id,"id"),g=false;if(d==="C"&&f.all>0){g=true}else if(d<=f.normal){g=true}if(c===0&&b.cost!==0){g=false}if(g===true){return true}}if(b.hasOwnProperty("restricted_to")&&(!/lesserwarlock|journeyman|marshall/i.test(b.type)||/^ua/i.test(b.type))){var h=b.restricted_to;if(typeof b.restricted_to!=="string"){h=b.restricted_to.join("|")}var i=a.countSelectedModel(h,"id"),j=a.countSelectedModel(b.id,"id");if(i.all===0){return true}if(!/^war/i.test(b.type)||/^war/i.test(b.type)&&b.cost===0){if(!(i.all>0&&i.all>j.all)){return true}}if(/^ua$|^wa$/i.test(b.type)){if(a.searchFreeUnit(b)===false){return true}}}return false};a.checkModelTier=function(b){var c=a.vars.tiers[a.options.gameTier];return c.levels[0].onlyModels.ids.indexOf(b.id)===-1};a.countSelectedModel=function(b,c,d){if(typeof c==="undefined"){c="type"}if(typeof d==="undefined"){d=false}var e=0,f=0,g=new RegExp(b,"i");if(a.hasOwnProperty("vars")&&a.vars.selectedModels){var h=function(a){$.each(a,function(a,b){if(g.test(b[c])){if(b.freeModel){f++}else{e++}}h(b.group)})};if(d!==false){h(a.vars.selectedModels[d].group)}else{h(a.vars.selectedModels)}}return{normal:e,free:f,all:e+f}};a.searchFreeUnit=function(b){var c=a.vars.selectedModels.length-1,d=b.restricted_to,e=false;if(typeof b.restricted_to==="string"){d=[b.restricted_to]}for(var f=0;f<=c;f++){if(d.indexOf(a.vars.selectedModels[f].id)!==-1){if(a.countSelectedModel("^"+b.type+"$","type",f).all===0&&a.countSelectedModel(b.id,"id",f).all===0){e=f}}if(e!==false){break}}return e};a.checkDropable=function(b,c){if(c===a.vars.dragging.group){return true}if(/^warbeast$|^warjack$/i.test(a.vars.dragging.model.type)){if(/^warlock$|^warcaster$|lesserwarlock|journeyman|marshall/i.test(b.type)){if(!b.hasOwnProperty("restricted_to")||b.hasOwnProperty("restricted_to")&&b.restricted_to.indexOf(a.vars.dragging.model.id)!==-1){return!(!/marshall/i.test(b.type)||/marshall/i.test(b.type)&&a.countSelectedModel("^warb|^warj","type",c).normal<2)}else{return true}}else{return true}}else if(a.vars.dragging.model.hasOwnProperty("restricted_to")){if(a.vars.dragging.model.restricted_to.indexOf(b.id)!==-1){return!(a.countSelectedModel("^"+b.type+"$","type",c).all===0&&a.countSelectedModel(a.vars.dragging.model.id,"id",c).all===0)}else{return true}}else if(/^soloatt/i.test(a.vars.dragging.model.type)&&!/^warlock$|^warcaster$/i.test(b.type)&&a.countSelectedModel("!^war","type",c).all>0){return true}return false};a.dropCallback=function(b,c){var d=angular.element(c.draggable).scope();a.addModel(d.model)};a.startCallback=function(a,b){var c=b.helper.prevObject.width();b.helper.css({width:c})};a.addModel=function(b){if(!a.checkModelAvailable(b)){var c=angular.copy(b);c.group=[];if(/^wa$/i.test(b.type)){c.attached=1}var d=false;if(/^warbeast$|^warjack$/i.test(b.type)){for(var e=a.vars.selectedModels.length-1;e>=0;e--){if(/^warlock$|^warcaster$|lesserwarlock|journeyman|marshall/i.test(a.vars.selectedModels[e].type)){if(!a.vars.selectedModels[e].hasOwnProperty("restricted_to")||a.vars.selectedModels[e].hasOwnProperty("restricted_to")&&a.vars.selectedModels[e].restricted_to.indexOf(b.id)!==-1){if(!/marshall/i.test(a.vars.selectedModels[e].type)||/marshall/i.test(a.vars.selectedModels[e].type)&&a.countSelectedModel("^warb|^warj","type",e).normal<2){d=e;break}}}}}else if(b.hasOwnProperty("restricted_to")){d=a.searchFreeUnit(b)}else if(/^soloatt/i.test(b.type)){for(var e=a.vars.selectedModels.length-1;e>=0;e--){if(/^warlock$|^warcaster$/i.test(a.vars.selectedModels[e].type)){d=e;break}}}if(a.vars.tier){var f=a.getModelCost(b,true);if(f===0){c.realCost=c.cost;c.cost=0;c.freeModel=1}}if(d!==false){c.bonded=1;if(/uamarshall/i.test(c.type)){a.vars.selectedModels[d].type="unitMarshall"}a.vars.selectedModels[d].group.push(c)}else if(a.countSelectedModel("^warlock|^warcaster").all===0&&/^warlock|^warcaster/i.test(c.type)){a.vars.selectedModels.splice(0,0,c)}else{a.vars.selectedModels.push(c)}a.calculatePoints()}};a.removeModel=function(b,c){var d=false;var e=false;if(typeof c==="undefined"){d=a.vars.selectedModels;e=a.vars.selectedModels.indexOf(b)}else{d=a.vars.selectedModels[c].group;e=a.vars.selectedModels[c].group.indexOf(b)}if(d[e].group.length>0){if(!confirm("if you remove this model all grouped models also remove")){return false}}if(typeof c!=="undefined"&&/uamarshall/i.test(d[e].type)){if(!confirm("if you remove this model the unit lose unitMarshall and all jacks are also remove")){return false}a.vars.selectedModels[c].type="unit";for(var f=a.vars.selectedModels[c].group.length-1;f>=0;f--){var g=a.vars.selectedModels[c].group[f];if(/^warb|^warj/i.test(g.type)){a.vars.selectedModels[c].group.splice(e,1)}}}d.splice(e,1);a.calculatePoints()};a.canUseMax=function(b){return!b.useMax&&parseInt(a.options.gamePoints)-parseInt(a.vars.points)+parseInt(b.cost)<parseInt(b.costMax)};a.canUseAttached=function(b,c){return b.attached<c&&parseInt(a.options.gamePoints)-parseInt(a.vars.points)+parseInt(b.cost*b.attached)<parseInt(b.cost*c)};a.calculatePoints=function(){a.calculateTierLevel();a.checkFreeSelected();a.updateSearch();var b=0;var c=0;$.each(a.vars.selectedModels,function(d,e){var f=a.getModelCost(e);if(/^warlock$|^warcaster$/i.test(e.type)){c=c+parseInt(f)}else{b=b+f}$.each(e.group,function(e,f){var g=a.getModelCost(f,false,false,d);if(/^warjack$|^warbeast$/i.test(f.type)){c=c-g}else{b=b+g}})});if(c<0){a.vars.points=b-c*+1}else{a.vars.points=b}a.vars.casterPoints=c};a.calculateTierLevel=function(){if(a.vars.tier&&a.vars.tier.hasOwnProperty("levels")){a.resetTierBonus();$.each(a.vars.tier.levels,function(b,c){var d=0;if(!c.mustHave[0]){a.vars.tierLevel=c.level;a.setTierBonus(c)}else{$.each(c.mustHave,function(b,c){if(c.min<=a.countSelectedModel(c.ids.join("|"),"id").normal){d++}});if(c.mustHave.length===d){a.vars.tierLevel=c.level;a.setTierBonus(c)}else{return false}}})}};a.setTierBonus=function(b){if(b.costAlterations.length>0){$.each(b.costAlterations,function(b,c){a.vars.costAlterations[c.id]=c.bonus})}if(b.freeModels.length>0){$.each(b.freeModels,function(b,c){var d=0;if(c.forEach){d=a.countSelectedModel(c.forEach.join("|"),"id").all}else{d=1}a.vars.freeModels.id=c.id;a.vars.freeModels.count=d})}if(b.faAlterations.length>0){$.each(b.faAlterations,function(b,c){if(c.forEach){a.vars.faAlterations[c.id]=a.countSelectedModel(c.forEach.join("|"),"id").all}else{a.vars.faAlterations[c.id]=c.bonus}})}};a.resetTierBonus=function(){a.vars.costAlterations=[];a.vars.freeModels={id:[],count:0};a.vars.faAlterations=[]};a.checkFreeSelected=function(){var b=function(c){$.each(c,function(c,d){if(d.hasOwnProperty("freeModel")){var e=true;if(a.vars.freeModels.id.length>0){e=$.inArray(d.id,a.vars.freeModels.id)!==-1&&a.countSelectedModel(a.vars.freeModels.id.join("|"),"id").free<=a.vars.freeModels.count}else{e=false}if(!e){d.cost=d.realCost;delete d.freeModel;delete d.realCost;a.calculateTierLevel()}}b(d.group)})};b(a.vars.selectedModels)};a.getModelCost=function(b,c,d,e){if(typeof c==="undefined"){c=false}if(typeof d==="undefined"){d=false}if(typeof e==="undefined"){e=false}var f;if(d&&b.hasOwnProperty("costMax")||b.hasOwnProperty("useMax")&&b.useMax){f=parseInt(b.costMax)}else if(b.hasOwnProperty("attached")){f=parseInt(b.cost*b.attached)}else{f=parseInt(b.cost)}if(e!==false&&a.vars.selectedModels[e].hasOwnProperty("bonded_bonus")){f=f-a.vars.selectedModels[e].bonded_bonus}if(a.vars.tier){var g=a.vars.costAlterations[b.id];if(g){f-=g}if(a.vars.freeModels.id.length>0&&c){var h=$.inArray(b.id,a.vars.freeModels.id)!==-1;if(a.countSelectedModel(a.vars.freeModels.id.join("|"),"id").free<a.vars.freeModels.count&&h){f=parseInt(0)}}}return f};a.isBonusCost=function(b,c,d){if(!a.vars.tier){return false}if(typeof c==="undefined"){c=true}var e=b.cost;if(b.hasOwnProperty("freeModel")&&b.freeModel===1&&b.cost===0){return true}else if(/^unit/i.test(b.type)){if(b.useMax===true){e=b.costMax}}else if(/^wa$/i.test(b.type)){e=b.cost*b.attached}return e!==a.getModelCost(b,c,false,d)};a.getModelFa=function(b){var c=b.fa;if(a.vars.tier&&b.fa&&b.fa!=="C"){var d=a.vars.faAlterations[b.id];if(d){c=parseInt(b.fa)+parseInt(d)}}if(c>100){c="U"}if(!c){c="C"}return c};a.notSorted=function(a){if(!a){return[]}return Object.keys(a)};a.createModStr=function(a){};a.updateSearch=function(){var b={},c=[];var e=function(a){$.each(a,function(a,b){var d=b.id;if(b.hasOwnProperty("useMax")&&b.useMax===true){d+=":m"}if(b.hasOwnProperty("bonded")&&b.bonded===1){d+=":b"}if(b.hasOwnProperty("freeModel")&&b.freeModel===1){d+=":f"}if(b.hasOwnProperty("attached")){d+=":a#"+b.attached}c.push(d);e(b.group)})};e(a.vars.selectedModels);b.sel=btoa(c);b.caster=a.options.gameCaster;b.points=a.options.gamePoints;b.tier=a.options.gameTier===0?"":a.options.gameTier;b.objective=a.options.gameObjective;d.search(b)};a.restoreSearch=function(){var b=d.search();if(b.points){a.options.gamePoints=b.points}if(b.caster){a.options.gameCaster=b.caster}if(b.tier){a.options.gameTier=b.tier;a.vars.tier=a.vars.tiers[a.options.gameTier]}if(b.objective){a.options.gameObjective=b.objective}if(b.sel){var c=atob(b.sel),e=c.split(",");$.each(e,function(b,c){a.addModelByString(c)})}a.calculatePoints()};a.addModelByString=function(b){var c=b.split(":");var d={};$.each(a.data,function(a,b){$.each(b.entries,function(a,b){if(b.id===c[0]){d=angular.copy(b);return false}});if(d.length>0){return false}});if(!$.isEmptyObject(d)){d.group=[];for(var e=0;e<=c.length;e++){if(c[e]==="bonded"||c[e]==="b"){d.bonded=1}if(c[e]==="useMax"||c[e]==="m"){d.useMax=true}if(c[e]==="freeModel"||c[e]==="f"){d.freeModel=1;d.realCost=d.cost;d.cost=0}if(/^attached/i.test(c[e])||/^a#/i.test(c[e])){var f=c[e].split("#");d.attached=parseInt(f[1])}}if(d.bonded===1){var g=a.vars.selectedModels.length-1;if(/uamarshall/i.test(d.type)){a.vars.selectedModels[g].type="unitMarshall"}a.vars.selectedModels[g].group.push(d)}else{a.vars.selectedModels.push(d)}}};a.getModelById=function(b){var c=false;$.each(a.data,function(a,d){$.each(d.entries,function(a,d){if(d.id===b){c=d;return true}});if(c){return true}});return c};a.changeTier=function(){a.vars.tier=a.vars.tiers[a.options.gameTier];a.clearList();if(a.vars.tier!==undefined&&a.vars.tier.hasOwnProperty("casterId")){a.addModelByString(a.vars.tier.casterId);$(".army-models:eq(1) .accordion-container").slideDown().parent().siblings().find(".accordion-container").slideUp()}};a.clearList=function(){a.vars.selectedModels=[];a.calculatePoints()};a.saveListAsFav=function(){var a=window.location.href;var b=document.title;if("addToHomescreen"in window&&window.addToHomescreen.isCompatible){addToHomescreen({autostart:false,startDelay:0}).show(true)}else if(window.sidebar&&window.sidebar.addPanel){window.sidebar.addPanel(b,a,"")}else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){$(this).attr({href:a,title:b,rel:"sidebar"}).off(e);return true}else if(window.external&&"AddFavorite"in window.external){window.external.AddFavorite(a,b)}else{alert("Press "+(/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+"+D to bookmark this page.")}return false};a.devAddId=function(){$.each(a.data,function(a,b){$.each(b.entries,function(a,b){b.name=b.id+" - "+b.name})})}}]);"use strict";troopCreator.controller("dashboardCtrl",["$scope","$http",function(a,b){}]);"use strict";angular.module("navModule",[]).directive("navD",function(){return{templateUrl:"nav.html",replace:true,controller:"navCtrl"}}).controller("navCtrl",["$scope","$rootScope","$http","$timeout","$location",function(a,b,c,d,e){c.get("./data/nav.json").success(function(b,c,d,e){a.armys=b}).error(function(a,b,c,d){alert("error reading navigation")});a.menuActive=false;a.menuToggle=function(){if($("#navi-icon").is(":visible")){a.menuActive=!a.menuActive;if(a.menuActive){$("#top-menu").slideDown()}else{$("#top-menu").slideUp()}}}}]);
//# sourceMappingURL=troopcreator.min.js.map